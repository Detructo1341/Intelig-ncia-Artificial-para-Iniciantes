<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mentor Metacognitivo de IA - Laborat√≥rio de Flu√™ncia</title>
    <style>
        /* Estilos b√°sicos para demonstrar a estrutura e a hierarquia */
        body {
            font-family: 'Inter', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f7f9;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: #ffffff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }
        header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #1a237e;
            padding-bottom: 15px;
        }
        h1 {
            color: #1a237e; /* Azul Escuro */
            font-size: 2.2em;
            margin-bottom: 5px;
        }
        h2 {
            color: #0d47a1;
            font-size: 1.5em;
            border-bottom: 1px solid #c5cae9;
            padding-bottom: 5px;
            margin-top: 25px;
        }
        .interaction-area {
            border: 1px solid #a9a9a9;
            padding: 25px;
            margin-bottom: 30px;
            border-radius: 10px;
            background-color: #e8eaf6; /* Azul Claro Suave */
        }
        label {
            display: block;
            font-weight: bold;
            margin-top: 15px;
            color: #333;
        }
        textarea {
            width: 100%;
            padding: 12px;
            margin-top: 8px;
            border: 1px solid #7986cb;
            border-radius: 6px;
            resize: vertical;
            box-sizing: border-box; /* Garante que padding n√£o estoure a largura */
            font-size: 1em;
        }
        button {
            background-color: #4caf50; /* Verde */
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 15px;
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.1s ease;
        }
        button:hover {
            background-color: #45a049;
            transform: translateY(-1px);
        }
        button:active {
            transform: translateY(1px);
        }
        .reflection-log {
            margin-top: 25px;
        }
        .log-entry {
            border-left: 6px solid #ff9800; /* Laranja Metacognitivo */
            padding: 15px 20px;
            margin-bottom: 20px;
            background-color: #fff3e0;
            border-radius: 6px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        .log-entry strong {
            color: #e65100;
            display: block;
            margin-bottom: 5px;
            font-size: 1.1em;
        }
        .log-entry p {
            margin: 5px 0;
            line-height: 1.5;
        }
        #ai-output-1 {
            white-space: pre-wrap; 
            background-color: #fff; 
            padding: 15px; 
            border: 2px dashed #7986cb;
            border-radius: 4px;
            min-height: 80px;
            margin-top: 10px;
        }
        .reflection-prompt {
            color: #d84315; /* Vermelho Alaranjado */
            font-style: italic;
            margin-top: 15px;
            font-weight: 600;
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1> Mentor Metacognitivo de IA üß†</h1>
            <p>Laborat√≥rio de Pr√°tica: Planejamento, Refinamento e Julgamento Cr√≠tico.</p>
        </header>

        <!-- Se√ß√£o 1: Planejamento Estrat√©gico e Entrada do Usu√°rio -->
        <div id="planning-section" class="interaction-area">
            <h2>1. Planejamento Estrat√©gico (Entrada)</h2>
            <label for="user-goal">Qual √© seu Objetivo Final com a IA? (Ex: "Criar um resumo de 500 palavras sobre IA generativa para leigos")</label>
            <textarea id="user-goal" rows="2">Criar um artigo de 500 palavras sobre o impacto da IA no futuro do trabalho para um p√∫blico de l√≠deres empresariais.</textarea>
            
            <label for="initial-prompt">Escreva seu **Prompt Inicial** (Bruto):</label>
            <textarea id="initial-prompt" rows="5" placeholder="Ex: 'Fa√ßa um resumo sobre IA generativa'">Escreva um artigo sobre o futuro do trabalho e IA.</textarea>
            
            <button onclick="simulateAIAssessment()">Enviar e Receber Avalia√ß√£o Estrat√©gica</button>
        </div>

        <!-- Se√ß√£o 2: Sa√≠da da IA e An√°lise de Refinamento -->
        <div id="refinement-section" class="interaction-area" style="display:none;">
            <h2>2. Itera√ß√£o e Refinamento</h2>
            
            <h3>Resposta Bruta da IA (Sa√≠da 1 - Gera√ß√£o)</h3>
            <p id="ai-output-1">[Resposta gen√©rica da IA ser√° inserida aqui]</p>
            
            <p class="reflection-prompt">ü§î **Reflex√£o Metacognitiva do Mentor:** "Por que a IA respondeu assim? Que pressupostos ela fez ao processar o seu pedido? Onde o prompt falhou em especificar a **audi√™ncia** ou o **tom**?"</p>
            
            <label for="refined-prompt">Escreva seu **Prompt Refinado** (Ap√≥s a an√°lise cr√≠tica):</label>
            <textarea id="refined-prompt" rows="5" placeholder="Ex: 'Assuma o papel de um professor de ensino m√©dio... O resumo deve ter 500 palavras, em tom inspirador e com exemplos cotidianos.'">Assuma o papel de um consultor de estrat√©gia. O artigo deve ter 500 palavras. Use um tom formal e persuasivo. Foco em tend√™ncias de requalifica√ß√£o (upskilling) e tomada de decis√£o estrat√©gica para C-Levels.</textarea>
            
            <button onclick="simulateRefinedOutput()">Testar Prompt Refinado</button>
        </div>

        <!-- Se√ß√£o 3: Log de Aprendizado Cr√≠tico e Ag√™ncia Humana -->
        <div id="critical-log-section" class="reflection-log">
            <h2>3. Log de Aprendizado Metacognitivo</h2>
            
            <!-- Entrada de Log 1: An√°lise Estrat√©gica -->
            <div class="log-entry" id="log-entry-1" style="display:none;">
                <strong>‚ñ∂Ô∏è An√°lise Estrat√©gica Inicial (M√≥dulo 1)</strong>
                <p id="log-analysis-1"></p>
                <p class="reflection-prompt">üí° **Quest√£o de Ag√™ncia Humana (M√≥dulo 4):** Qual **Julgamento Humano** √∫nico (empatia, √©tica, contexto da sua empresa) voc√™ deve aplicar antes de usar esta sa√≠da da IA? O que a m√°quina n√£o consegue avaliar?</p>
            </div>

            <!-- Entrada de Log 2: An√°lise de Refinamento -->
            <div class="log-entry" id="log-entry-2" style="display:none;">
                <strong>‚ñ∂Ô∏è Resultado do Refinamento e Insight (M√≥dulos 2 & 3)</strong>
                <p id="log-analysis-2"></p>
                <p class="reflection-prompt">‚úÖ **S√≠ntese e A√ß√£o (M√≥dulo 3):** Qual √© o **conhecimento acion√°vel** (insight) que voc√™ extraiu da Resposta Refinada? Como isso se traduz em uma **decis√£o real**?</p>
            </div>
        </div>
        
    </div>

    <script>
        // Use a global variable to store the simulated API base URL
        const apiKey = "";
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

        // Utility function for Base64 to ArrayBuffer (for TTS)
        function base64ToArrayBuffer(base64) {
            const binaryString = window.atob(base64);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            return bytes.buffer;
        }

        // Utility function to convert PCM data to WAV Blob (for TTS)
        function pcmToWav(pcm16, sampleRate) {
            const numChannels = 1;
            const bitsPerSample = 16;
            const byteRate = sampleRate * numChannels * (bitsPerSample / 8);
            const blockAlign = numChannels * (bitsPerSample / 8);
            const dataSize = pcm16.byteLength;
            const buffer = new ArrayBuffer(44 + dataSize);
            const view = new DataView(buffer);
            
            // Function to write a string to the data view
            function writeString(view, offset, string) {
                for (let i = 0; i < string.length; i++) {
                    view.setUint8(offset + i, string.charCodeAt(i));
                }
            }

            // RIFF chunk descriptor
            writeString(view, 0, 'RIFF'); // ChunkID
            view.setUint32(4, 36 + dataSize, true); // ChunkSize
            writeString(view, 8, 'WAVE'); // Format

            // FMT sub-chunk
            writeString(view, 12, 'fmt '); // Subchunk1ID
            view.setUint32(16, 16, true); // Subchunk1Size (16 for PCM)
            view.setUint16(20, 1, true); // AudioFormat (1 for PCM)
            view.setUint16(22, numChannels, true); // NumChannels
            view.setUint32(24, sampleRate, true); // SampleRate
            view.setUint32(28, byteRate, true); // ByteRate
            view.setUint16(32, blockAlign, true); // BlockAlign
            view.setUint16(34, bitsPerSample, true); // BitsPerSample

            // Data sub-chunk
            writeString(view, 36, 'data'); // Subchunk2ID
            view.setUint32(40, dataSize, true); // Subchunk2Size

            // Write PCM data
            const pcm16Bytes = new Uint8Array(pcm16.buffer);
            for (let i = 0; i < dataSize; i++) {
                view.setUint8(44 + i, pcm16Bytes[i]);
            }

            return new Blob([view], { type: 'audio/wav' });
        }


        // Fun√ß√£o de backoff exponencial para lidar com limites de taxa
        async function fetchWithExponentialBackoff(url, options, maxRetries = 5, delay = 1000) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.status !== 429) { // 429 is Too Many Requests
                        return response;
                    }
                    console.log(`Rate limit exceeded (429). Retrying in ${delay / 1000}s...`);
                } catch (error) {
                    console.error('Fetch error:', error);
                    // Decide if the error is worth retrying (e.g., network error)
                }
                await new Promise(resolve => setTimeout(resolve, delay * Math.pow(2, i)));
            }
            throw new Error('Failed to fetch after multiple retries.');
        }

        // --- L√≥gica Principal do Agente ---

        // Fun√ß√£o para obter a resposta da IA (simulando a chamada real ao LLM)
        async function getGeminiResponse(systemPrompt, userQuery) {
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
                // Usando o Google Search para garantir informa√ß√µes atualizadas
                tools: [{ "google_search": {} }],
            };

            const options = {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            };

            try {
                const response = await fetchWithExponentialBackoff(apiUrl, options);
                const result = await response.json();
                
                // Extra√ß√£o segura do texto gerado
                return result.candidates?.[0]?.content?.parts?.[0]?.text || "Erro: A IA n√£o conseguiu gerar uma resposta. Tente refinar a pergunta.";
            } catch (error) {
                console.error("Erro na chamada √† API Gemini:", error);
                return "Erro de Conex√£o: Falha ao comunicar com o Mentor de IA. Verifique sua conex√£o.";
            }
        }

        // M√≥dulo 1: Planejamento Estrat√©gico e Entrada
        async function simulateAIAssessment() {
            const goal = document.getElementById('user-goal').value;
            const initialPrompt = document.getElementById('initial-prompt').value;
            const aiOutputElement = document.getElementById('ai-output-1');

            if (!goal || !initialPrompt) {
                alert("Por favor, preencha o Objetivo Final e o Prompt Inicial.");
                return;
            }

            // Exibir carregamento
            aiOutputElement.textContent = "‚öôÔ∏è Processando a Avalia√ß√£o Estrat√©gica e Gerando Sa√≠da 1...";
            
            // 1. System Prompt para o Agente (Estrategista e Gerador de Conte√∫do)
            const systemPromptInitial = `Voc√™ √© o Mentor Metacognitivo de IA. Seu papel √© duplo:
            1. AGIR como um Estrategista: Avalie o objetivo do usu√°rio ("${goal}") e seu prompt inicial ("${initialPrompt}"). Identifique claramente o que est√° faltando (Papel da IA, P√∫blico, Formato, Tom).
            2. AGIR como um LLM: Gere a primeira "Resposta Bruta" (Sa√≠da 1) com base no prompt do usu√°rio. A Sa√≠da 1 deve ser propositalmente gen√©rica, pois o prompt do usu√°rio √© fraco.

            FORMATO DE SA√çDA OBRIGAT√ìRIO:
            ---AN√ÅLISE ESTRAT√âGICA---
            [Sua avalia√ß√£o sobre as lacunas no prompt inicial]
            ---SA√çDA 1 (BRUTA)---
            [A resposta da IA para o prompt, sendo gen√©rica]`;

            const queryInitial = `Meu objetivo √©: "${goal}". Meu prompt inicial √©: "${initialPrompt}". Por favor, gere a an√°lise estrat√©gica e a Resposta Bruta.`;

            const fullResponse = await getGeminiResponse(systemPromptInitial, queryInitial);

            // Analisar a resposta para separar An√°lise e Sa√≠da
            const [analysisBlock, outputBlock] = fullResponse.split('---SA√çDA 1 (BRUTA)---').map(s => s.trim());
            const analysisText = analysisBlock.replace('---AN√ÅLISE ESTRAT√âGICA---', '').trim();
            const outputText = (outputBlock || "N√£o foi poss√≠vel extrair a Resposta Bruta.").trim();

            // Atualizar UI
            aiOutputElement.textContent = outputText;
            document.getElementById('log-analysis-1').innerHTML = analysisText.replace(/\n/g, '<br>');

            // Exibir as se√ß√µes de Refinamento e Log
            document.getElementById('refinement-section').style.display = 'block';
            document.getElementById('log-entry-1').style.display = 'block';

            // Mensagem de Feedback
            if (!outputText.includes("Erro")) {
                // N√£o usamos alert, mas um feedback visual
                const feedbackMsg = document.createElement('div');
                feedbackMsg.textContent = "‚úÖ Avalia√ß√£o Estrat√©gica Conclu√≠da. Analise a Sa√≠da 1 e o Log de Aprendizado abaixo para refinar seu prompt.";
                feedbackMsg.style.cssText = "color: #1b5e20; background-color: #e8f5e9; padding: 10px; border-radius: 4px; margin-top: 10px; font-weight: bold;";
                document.getElementById('planning-section').appendChild(feedbackMsg);
            }
        }

        // M√≥dulo 2 e 3: Itera√ß√£o, Refinamento e S√≠ntese
        async function simulateRefinedOutput() {
            const goal = document.getElementById('user-goal').value;
            const refinedPrompt = document.getElementById('refined-prompt').value;
            const aiOutputElement = document.getElementById('ai-output-1');

            if (!refinedPrompt) {
                alert("Por favor, escreva o Prompt Refinado.");
                return;
            }

            // Exibir carregamento
            aiOutputElement.textContent = "‚öôÔ∏è Processando o Prompt Refinado e Gerando An√°lise Cr√≠tica...";

            // 1. System Prompt para o Agente (Refinador e Sintetizador Cr√≠tico)
            const systemPromptRefined = `Voc√™ √© o Mentor Metacognitivo de IA. Seu papel √© duplo:
            1. AGIR como um LLM: Gere a "Resposta Refinada" (Sa√≠da 2) usando o novo prompt do usu√°rio. Esta resposta deve ser de alta qualidade, pois o prompt agora √© detalhado.
            2. AGIR como um Sintetizador Cr√≠tico: Compare a qualidade da Sa√≠da 2 com a Sa√≠da 1 (que era gen√©rica). Foque em como a mudan√ßa no prompt (causa) levou √† melhora do resultado (efeito). Depois, gere um "Insight Acion√°vel" para o usu√°rio.

            FORMATO DE SA√çDA OBRIGAT√ìRIO:
            ---AN√ÅLISE CR√çTICA---
            [Sua compara√ß√£o e an√°lise de causa/efeito do refinamento do prompt.]
            ---SA√çDA 2 (REFINADA)---
            [A resposta da IA para o prompt refinado, sendo de alta qualidade e focada.]`;
            
            const queryRefined = `Meu objetivo √©: "${goal}". O meu novo Prompt Refinado √©: "${refinedPrompt}". Por favor, gere a an√°lise cr√≠tica e a Resposta Refinada.`;

            const fullResponse = await getGeminiResponse(systemPromptRefined, queryRefined);

            // Analisar a resposta para separar An√°lise e Sa√≠da
            const [analysisBlock, outputBlock] = fullResponse.split('---SA√çDA 2 (REFINADA)---').map(s => s.trim());
            const analysisText = analysisBlock.replace('---AN√ÅLISE CR√çTICA---', '').trim();
            const outputText = (outputBlock || "N√£o foi poss√≠vel extrair a Resposta Refinada.").trim();

            // Atualizar UI
            aiOutputElement.textContent = outputText;
            document.getElementById('log-analysis-2').innerHTML = analysisText.replace(/\n/g, '<br>');
            document.getElementById('log-entry-2').style.display = 'block';

            // Mensagem de Feedback
            if (!outputText.includes("Erro")) {
                const feedbackMsg = document.createElement('div');
                feedbackMsg.textContent = "‚úÖ Itera√ß√£o Completa. Analise o Log de Aprendizado abaixo para os Insights Finais e Conclus√£o Cr√≠tica.";
                feedbackMsg.style.cssText = "color: #1b5e20; background-color: #e8f5e9; padding: 10px; border-radius: 4px; margin-top: 10px; font-weight: bold;";
                document.getElementById('refinement-section').appendChild(feedbackMsg);
            }
        }
    </script>

</body>
</html>
